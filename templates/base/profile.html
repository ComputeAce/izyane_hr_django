{% extends 'includes/bootstrap.html' %}
{% load static %}

{% block content %}
<!--! ================================================================ !-->
<main class="nxl-container">
    <div class="nxl-content">
        <div class="page-header">
            <div class="page-header-left d-flex align-items-center">
                <div class="page-header-title">
                    <h5 class="m-b-10">Profile</h5>
                </div>
                <ul class="breadcrumb">
                    <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                    <li class="breadcrumb-item">User Profile</li>
                </ul>
            </div>
            <div class="page-header-right ms-auto">
                <div class="page-header-right-items">
                    <div class="d-flex d-md-none">
                        <a href="javascript:void(0)" class="page-header-right-close-toggle">
                            <i class="feather-arrow-left me-2"></i>
                            <span>Back</span>
                        </a>
                    </div>
                    
                </div>
                <div class="d-md-none d-flex align-items-center">
                    <a href="javascript:void(0)" class="page-header-right-open-toggle">
                        <i class="feather-align-right fs-20"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div class="row">
           
                <div class="col-lg-12">
                    <div class="card stretch stretch-full">
                        <div class="card-header">
                            <h5 class="card-title">User Profile</h5>


                        </div>

                        <div class="col-xxl-8 col-xl-6">
                            <div class="card border-top-0">
                                <div class="card-header p-0">
                                    <!-- Nav tabs -->
                                    <ul class="nav nav-tabs flex-wrap w-100 text-center customers-nav-tabs" id="myTab" role="tablist">
                                        <li class="nav-item flex-fill border-top" role="presentation">
                                            <a href="javascript:void(0);" class="nav-link active" data-bs-toggle="tab" data-bs-target="#overviewTab" role="tab">Overview</a>
                                        </li>
                                        <li class="nav-item flex-fill border-top" role="presentation">
                                            <a href="javascript:void(0);" class="nav-link" data-bs-toggle="tab" data-bs-target="#billingTab" role="tab">Update Profile</a>
                                        </li>
                                        <li class="nav-item flex-fill border-top" role="presentation">
                                            <a href="javascript:void(0);" class="nav-link" data-bs-toggle="tab" data-bs-target="#activityTab" role="tab">Settings</a>
                                        </li>
                                       
                                    </ul>
                                </div>
                                <div class="tab-content">

                                    <div class="tab-pane fade show active p-4" id="overviewTab" role="tabpanel">

                                        
                                            {% if messages %}
                                            <div class="container my-3">
                                                <div class="row justify-content-center">
                                                    <div class="col-md-8">
                                                        {% for message in messages %}
                                                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                                                            {{ message }}
                                                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                                        </div>
                                                        {% endfor %}
                                                    </div>
                                                </div>
                                            </div>
                                            {% endif %}
                                        
                                        <div class="profile-details mb-5">
                                            {% if request.user.profile.image %}
                                                        
                                                <img src="{{ request.user.profile.image.url }}" class="my-5 text-center justify-content-center avatar-image wd-150 ht-150 border border-5 border-gray-3" alt="" class="img-fluid">
                                                
                                                {% else %}
                                                
                                                    
                                                <img src="{% static 'profile2/user.jpg' %}" alt="" class="img-fluid">

                                            {% endif %}
                                            <div class="row g-0 mb-4">
                                                <div class="col-sm-6 text-muted">Full Name:</div>
                                                <div class="col-sm-6 fw-semibold">{{ request.user.first_name }} {{ request.user.last_name }}</div>
                                            </div>
                                            <div class="row g-0 mb-4">
                                                <div class="col-sm-6 text-muted">Email:</div>
                                                <div class="col-sm-6 fw-semibold">{{ request.user.email}}</div>
                                            </div>
                                            <div class="row g-0 mb-4">
                                                <div class="col-sm-6 text-muted">Phone Number:</div>
                                                <div class="col-sm-6 fw-semibold">{{ request.user.profile.phone_number }}</div>
                                            </div>
                                            <div class="row g-0 mb-4">
                                                <div class="col-sm-6 text-muted">Nhima:</div>
                                                <div class="col-sm-6 fw-semibold">{{ request.user.profile.nhima_number}}</div>
                                            </div>
                                            <div class="row g-0 mb-4">
                                                <div class="col-sm-6 text-muted">Social Security Number:</div>
                                                <div class="col-sm-6 fw-semibold">{{ request.user.profile.ssn }}</div>
                                            </div>
                                            <div class="row g-0 mb-4">
                                                <div class="col-sm-6 text-muted">T-pin Number:</div>
                                                <div class="col-sm-6 fw-semibold">{{ request.user.profile.tpin }}</div>
                                            </div>
                                            <div class="row g-0 mb-4">
                                                <div class="col-sm-6 text-muted">Address:</div>
                                                <div class="col-sm-6 fw-semibold">{{ request.user.profile.address}}</div>
                                            </div>
                                            <div class="row g-0 mb-4">
                                                <div class="col-sm-6 text-muted">Position:</div>
                                                <div class="col-sm-6 fw-semibold">{{ request.user.employee.position }}</div>
                                            </div>
                                            <div class="row g-0 mb-4">
                                                <div class="col-sm-6 text-muted">Salary:</div>
                                                <div class="col-sm-6 fw-semibold">{{ request.user.employee.salary_amount }}</div>
                                            </div>
                                            <div class="row g-0 mb-4">
                                                <div class="col-sm-6 text-muted">Salary Currency:</div>
                                                <div class="col-sm-6 fw-semibold">{{ request.user.employee.currency }}</div>
                                            </div>
                                            <div class="row g-0 mb-4">
                                                <div class="col-sm-6 text-muted">Employment:</div>
                                                <div class="col-sm-6 fw-semibold">{{ request.user.employee.employment_type }}</div>
                                            </div>
                                            

                                        </div>
                                       
                                        <div class="project-section">
                                            <div class="mb-4 d-flex align-items-center justify-content-between">
                                                <h5 class="fw-bold mb-0">Your Identity:</h5>
                                                <a href="javascript:void(0);" class="btn btn-sm btn-light-brand">View Alls</a>
                                            </div>
                                            <div class="row">
                                                <div class="col-xxl-6 col-xl-12 col-md-6">
                                                    <div class="border border-dashed border-gray-5 rounded mb-4 md-lg-0">
                                                        <div class="p-4">
                                                            
                                                            <img src="{{ request.user.profile.nrc_front.url }}" width="300" heigh="300" alt="NRC Front Image">

                                                           
                                                        </div>
                                                        
                                                    </div>
                                                </div>


                                                <div class="col-xxl-6 col-xl-12 col-md-6">
                                                    <div class="border border-dashed border-gray-5 rounded mb-4 md-lg-0">
                                                        <div class="p-4">
                                                            
                                                            <img src="{{ request.user.profile.nrc_front.url }}" width="300" heigh="300" alt="NRC Front Image">

                                                           
                                                        </div>
                                                        
                                                    </div>
                                                </div>
                                            
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="billingTab" role="tabpanel">
                                        <div class="subscription-plan px-4 pt-4">   
                                            <form action="{% url 'base:user_profile'  %}" method="POST">
                                                {% csrf_token %}
                                                <div class="mb-3">
                                                    <label for="email" class="form-label">Email</label>
                                                    <input type="email" class="form-control" id="email" name="email" placeholder="Email" value="{{ request.user.email }}">
                                                </div>
                                            
                                                <div class="mb-3">
                                                    <label for="firstName" class="form-label">First Name</label>
                                                    <input type="text" class="form-control" id="firstName" name="first_name" placeholder="Enter First Name" value="{{ request.user.first_name }}">
                                                </div>
                                            
                                                <div class="mb-3">
                                                    <label for="lastName" class="form-label">Last Name</label>
                                                    <input type="text" class="form-control" id="lastName" name="last_name" placeholder="Enter Last Name" value="{{ request.user.last_name }}">
                                                </div>
                                            
                                                <div class="mb-3">
                                                    <label for="address" class="form-label">Address</label>
                                                    <input type="text" class="form-control" id="address" name="address" placeholder="Enter Address" value="{{ request.user.profile.address }}">
                                                </div>
                                            
                                                <div class="mb-3">
                                                    <label for="phoneNumber" class="form-label">Phone Number</label>
                                                    <input type="tel" class="form-control" id="phoneNumber" name="phone_number" placeholder="Enter Phone Number" value="{{ request.user.profile.phone_number }}">
                                                </div>
                                            
                                                <div class="d-flex justify-content-center my-5">
                                                    <button type="submit" class="btn btn-primary">Update</button>
                                                </div>
                                            </form>                                          
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="activityTab" role="tabpanel">
                                       
                                      

                                        <div class="row justify-content-end mx-1 my-5">

                                            <div class="col-lg-6">
                                                <h4 class="my-2">Change Your Profile Picture</h4>

                                            
                                                {% if request.user.profile.image %}
                                                    <img id="profile-image" src="{{ request.user.profile.image.url }}" class="avatar-image wd-150 ht-150 border border-5 border-gray-3" alt="Profile Image" style="cursor: pointer;">
                                                {% else %}
                                                    <img id="profile-image" src="{% static 'profile2/user.jpg' %}" class="avatar-image wd-150 ht-150 border border-5 border-gray-3" alt="Default Profile Image" style="cursor: pointer;">
                                                {% endif %}
                                                <form action="{% url 'base:update_profile_img' %}" method="POST" enctype="multipart/form-data">
                                                    {% csrf_token %}
                                                    <input type="file" id="image-input" name="profile_picture" style="display: none;" accept="image/*">
                                                    <button type="submit" class="btn btn-primary mt-3">Update Profile Picture</button>
                                                </form>
                                            </div>
                                            

                                            <div class="col-lg-6">
                                                <h4 class="my-2">Change Your Password</h4>
                                                <div id="response-message" class="text-danger">
                                                    <!-- Response message content will be inserted here -->
                                                </div>
                                                
                                                <form id="change-password-form" method="POST" action="{% url 'base:submit_change_password' %}">
                                                    {% csrf_token %}
                                                    <div class="single-form">
                                                        <p>Current Password</p>
                                                        <div class="my-4" id="password-feedback" style="margin-top: 5px; font-size: 14px;"></div>
                                                        <input type="password" id="current_password" class="form-control" name="current_password" placeholder="********" required>
                                                    </div>
                                                    <div class="single-form" id="new-password-section" style="display: none;">
                                                        <p>New Password</p>
                                                        <input type="password" id="new_password" class="form-control" name="new_password" placeholder="********" required>
                                                    </div>
                                                    <div class="single-form" id="confirm-new-password-section" style="display: none;">
                                                        <p>Confirm New Password</p>
                                                        <input type="password" id="confirm_new_password" class="form-control" name="confirm_new_password" placeholder="********" required>
                                                    </div>
                                                    <div class="my-4" id="password-match-feedback" style="margin-top: 5px; font-size: 14px;"></div>
                                                    <button type="button" id="submitBtn" class="btn btn-primary" disabled>Update</button>
                                                </form>
                                            </div>
                                            

                                        </div>


                                        
                                       
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- [Recent Orders] end -->
                <!-- [] start -->
            </div>
        </div>
        <!-- [ Main Content ] end -->
    </div>
    <!-- [ Footer ] start -->
    <footer class="footer">
        <p class="fs-11 text-muted fw-medium text-uppercase mb-0 copyright">
            <span>Copyright ©</span>
            <script>
                document.write(new Date().getFullYear());
            </script>
        </p>
        <div class="d-flex align-items-center gap-4">
            <a href="javascript:void(0);" class="fs-11 fw-semibold text-uppercase">Help</a>
            <a href="javascript:void(0);" class="fs-11 fw-semibold text-uppercase">Terms</a>
            <a href="javascript:void(0);" class="fs-11 fw-semibold text-uppercase">Privacy</a>
        </div>
    </footer>
    <!-- [ Footer ] end -->
</main>
<!--! ================================================================ !-->
<!--! [End] Main Content !-->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'js/change_password.js' %}"></script>
<script>
    document.getElementById('profile-image').addEventListener('click', function() {
        document.getElementById('image-input').click();
    });

    document.getElementById('image-input').addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('profile-image').src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    });
</script>
{% endblock %}
